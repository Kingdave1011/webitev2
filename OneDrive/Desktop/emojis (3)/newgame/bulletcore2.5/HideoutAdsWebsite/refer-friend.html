<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refer a Friend - Space Shooter</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #05050A;
            color: #E0E0E0;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 100px 20px 50px;
        }
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            color: #00C6FF;
            text-shadow: 0 0 20px #00C6FF;
            margin-bottom: 20px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            color: #8A2BE2;
            font-size: 1.2rem;
            margin-bottom: 50px;
        }
        .referral-card {
            background: rgba(0, 198, 255, 0.1);
            border: 2px solid #00C6FF;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .referral-code-section {
            text-align: center;
            margin: 30px 0;
        }
        .referral-code {
            background: rgba(138, 43, 226, 0.2);
            border: 3px solid #8A2BE2;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: #00C6FF;
            margin: 20px 0;
            letter-spacing: 3px;
            user-select: all;
        }
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #00C6FF 0%, #8A2BE2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 198, 255, 0.5);
        }
        .btn.secondary {
            background: rgba(138, 43, 226, 0.3);
            border: 2px solid #8A2BE2;
        }
        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .reward-item {
            background: rgba(138, 43, 226, 0.2);
            border: 2px solid #8A2BE2;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .reward-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        .stats-section {
            background: rgba(0, 198, 255, 0.05);
            border: 2px solid #00C6FF;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 198, 255, 0.2);
        }
        .stat-row:last-child { border-bottom: none; }
        .notification {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00FF00;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        .notification.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 198, 255, 0.1);
            border: 2px solid #00C6FF;
            border-radius: 8px;
            color: #E0E0E0;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            margin: 10px 0;
        }
        input:focus {
            outline: none;
            border-color: #8A2BE2;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ Refer a Friend</h1>
        <p class="subtitle">Invite friends and earn exclusive rewards together!</p>
        
        <div class="referral-card">
            <h2 style="color: #00C6FF; font-family: 'Orbitron', sans-serif; margin-bottom: 20px;">Your Referral Code</h2>
            <div class="referral-code-section">
                <div class="referral-code" id="referral-code">LOADING...</div>
                <button class="btn" onclick="copyCode()">üìã Copy Code</button>
                <button class="btn secondary" onclick="shareCode()">üîó Share Link</button>
            </div>
            <div class="notification" id="notification"></div>
        </div>
        
        <div class="referral-card">
            <h2 style="color: #00C6FF; font-family: 'Orbitron', sans-serif; margin-bottom: 20px;">Reward Breakdown</h2>
            <div class="rewards-grid">
                <div class="reward-item">
                    <div class="reward-icon">üéÅ</div>
                    <h3 style="color: #00C6FF;">You Get</h3>
                    <p><strong>500 Credits</strong></p>
                    <p>+2 Shield Boosters</p>
                    <p>+2 Rapid Fire Boosters</p>
                    <p style="font-size: 0.9rem; margin-top: 10px; color: #8A2BE2;">Per friend who signs up!</p>
                </div>
                
                <div class="reward-item">
                    <div class="reward-icon">üéâ</div>
                    <h3 style="color: #00C6FF;">They Get</h3>
                    <p><strong>1000 Credits</strong></p>
                    <p>+3 Shield Boosters</p>
                    <p>+3 Rapid Fire Boosters</p>
                    <p>+2 Double Credit Boosters</p>
                    <p style="font-size: 0.9rem; margin-top: 10px; color: #8A2BE2;">Starter Bundle + Bonus!</p>
                </div>
            </div>
        </div>
        
        <div class="referral-card">
            <h2 style="color: #00C6FF; font-family: 'Orbitron', sans-serif; margin-bottom: 20px;">Your Stats</h2>
            <div class="stats-section">
                <div class="stat-row">
                    <span>Total Referrals:</span>
                    <strong id="total-referrals" style="color: #00C6FF;">0</strong>
                </div>
                <div class="stat-row">
                    <span>Credits Earned:</span>
                    <strong id="credits-earned" style="color: #FFD700;">0</strong>
                </div>
                <div class="stat-row">
                    <span>Boosters Earned:</span>
                    <strong id="boosters-earned" style="color: #FF6B35;">0</strong>
                </div>
            </div>
        </div>
        
        <div class="referral-card">
            <h2 style="color: #00C6FF; font-family: 'Orbitron', sans-serif; margin-bottom: 20px;">Have a Referral Code?</h2>
            <input type="text" id="enter-code" placeholder="Enter referral code..." maxlength="10">
            <button class="btn" onclick="applyReferralCode()">‚úÖ Apply Code</button>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="index.html" class="btn secondary">‚Üê Back to Home</a>
        </div>
    </div>

    <script>
        let myReferralCode = '';
        let currentUser = '';

        function generateReferralCode(username) {
            // Create a simple referral code based on username
            const hash = username.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            return username.substring(0, 4).toUpperCase() + hash.toString().substring(0, 4);
        }

        function loadUserData() {
            // Check if user is logged in
            const authData = sessionStorage.getItem('space_shooter_auth');
            if (authData) {
                const data = JSON.parse(authData);
                currentUser = data.username;
            } else {
                // Try to get from localStorage (if they've signed up before)
                const accounts = Object.keys(localStorage).filter(key => key.startsWith('acct_'));
                if (accounts.length > 0) {
                    currentUser = accounts[0].replace('acct_', '');
                } else {
                    currentUser = 'GUEST' + Math.random().toString(36).substring(7).toUpperCase();
                }
            }
            
            myReferralCode = generateReferralCode(currentUser);
            document.getElementById('referral-code').textContent = myReferralCode;
            
            updateStats();
        }

        function updateStats() {
            const rewards = JSON.parse(localStorage.getItem('referral_rewards') || '{}');
            const myRewards = rewards[myReferralCode] || 0;
            
            document.getElementById('total-referrals').textContent = myRewards;
            document.getElementById('credits-earned').textContent = myRewards * 500;
            document.getElementById('boosters-earned').textContent = myRewards * 4; // 2 shield + 2 rapid fire per referral
        }

        function copyCode() {
            navigator.clipboard.writeText(myReferralCode).then(() => {
                showNotification('‚úÖ Referral code copied to clipboard!');
            }).catch(() => {
                // Fallback for browsers that don't support clipboard API
                const code = document.getElementById('referral-code');
                const range = document.createRange();
                range.selectNode(code);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand('copy');
                showNotification('‚úÖ Referral code copied!');
            });
        }

        function shareCode() {
            const shareUrl = `${window.location.origin}/user-auth.html?ref=${myReferralCode}`;
            const shareText = `üöÄ Join me in Space Shooter! Use my referral code ${myReferralCode} for bonus rewards! `;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Space Shooter - Referral Code',
                    text: shareText,
                    url: shareUrl
                }).catch(() => {
                    // Fallback to copying URL
                    fallbackShare(shareUrl);
                });
            } else {
                fallbackShare(shareUrl);
            }
        }

        function fallbackShare(url) {
            navigator.clipboard.writeText(url).then(() => {
                showNotification('üîó Referral link copied to clipboard!');
            });
        }

        function applyReferralCode() {
            const code = document.getElementById('enter-code').value.trim().toUpperCase();
            if (!code) {
                showNotification('‚ùå Please enter a referral code', 'error');
                return;
            }
            
            if (code === myReferralCode) {
                showNotification('‚ùå You cannot use your own referral code!', 'error');
                return;
            }
            
            // Check if already used a code
            const usedCode = localStorage.getItem('used_referral_code');
            if (usedCode) {
                showNotification('‚ùå You have already used a referral code!', 'error');
                return;
            }
            
            // Store code in session for signup
            sessionStorage.setItem('referralCode', code);
            localStorage.setItem('used_referral_code', code);
            
            showNotification('‚úÖ Referral code applied! Sign up now to claim your bonus rewards!');
            
            setTimeout(() => {
                window.location.href = 'user-auth.html';
            }, 2000);
        }

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = 'notification show';
            
            if (type === 'error') {
                notif.style.background = 'rgba(255, 0, 0, 0.2)';
                notif.style.borderColor = '#FF0000';
            } else {
                notif.style.background = 'rgba(0, 255, 0, 0.2)';
                notif.style.borderColor = '#00FF00';
            }
            
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        // Check for referral code in URL
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        if (refCode) {
            sessionStorage.setItem('referralCode', refCode);
            document.getElementById('enter-code').value = refCode;
            showNotification('üéÅ Referral code detected! Sign up to claim your bonus!');
        }

        // Load user data on page load
        loadUserData();
    </script>
</body>
</html>
